@{
    ViewData["Title"] = "Äá»•i máº­t kháº©u";
    Layout = "~/Areas/KhachHang/Views/Shared/_Layout_KhachHang.cshtml";
}

<!-- Animated Background Effects -->
<div class="animated-background">
    <!-- Aurora Effect -->
    <div class="aurora"></div>

    <!-- Organic Nature Patterns -->
    <div class="organic-pattern"></div>
    <div class="organic-pattern"></div>
    <div class="organic-pattern"></div>

    <!-- Floating Leaves -->
    <div class="leaf maple" style="left: 5%; animation-delay: 0s;">ğŸ</div>
    <div class="leaf oak" style="left: 15%; animation-delay: -3s;">ğŸƒ</div>
    <div class="leaf birch" style="left: 25%; animation-delay: -6s;">ğŸŒ¿</div>
    <div class="leaf maple" style="left: 35%; animation-delay: -9s;">ğŸ‚</div>
    <div class="leaf small" style="left: 45%; animation-delay: -12s;">ğŸŒ±</div>
    <div class="leaf oak" style="left: 55%; animation-delay: -2s;">ğŸƒ</div>
    <div class="leaf birch" style="left: 65%; animation-delay: -5s;">ğŸŒ¿</div>
    <div class="leaf maple" style="left: 75%; animation-delay: -8s;">ğŸ</div>
    <div class="leaf small" style="left: 85%; animation-delay: -11s;">ğŸŒ±</div>
    <div class="leaf oak" style="left: 95%; animation-delay: -14s;">ğŸƒ</div>

    <!-- Floating Flower Petals -->
    <div class="flower-petal sakura" style="left: 8%; animation-delay: -1s;">ğŸŒ¸</div>
    <div class="flower-petal rose" style="left: 18%; animation-delay: -4s;">ğŸŒ¹</div>
    <div class="flower-petal daisy" style="left: 28%; animation-delay: -7s;">ğŸŒ¼</div>
    <div class="flower-petal lavender" style="left: 38%; animation-delay: -10s;">ğŸ’œ</div>
    <div class="flower-petal sakura" style="left: 48%; animation-delay: -13s;">ğŸŒ¸</div>
    <div class="flower-petal rose" style="left: 58%; animation-delay: -2.5s;">ğŸŒº</div>
    <div class="flower-petal daisy" style="left: 68%; animation-delay: -5.5s;">ğŸŒ¼</div>
    <div class="flower-petal lavender" style="left: 78%; animation-delay: -8.5s;">ğŸŒ»</div>
    <div class="flower-petal sakura" style="left: 88%; animation-delay: -11.5s;">ğŸŒ¸</div>

    <!-- Nature Elements -->
    <div class="nature-element branch" style="left: 12%; animation-delay: -3s;">ğŸŒ³</div>
    <div class="nature-element grass" style="left: 32%; animation-delay: -8s;">ğŸŒ¾</div>
    <div class="nature-element seed" style="left: 52%; animation-delay: -13s;">ğŸŒ°</div>
    <div class="nature-element branch" style="left: 72%; animation-delay: -5s;">ğŸŒ²</div>
    <div class="nature-element grass" style="left: 92%; animation-delay: -10s;">ğŸŒ¾</div>

    <!-- Floating Bubbles -->
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>
    <div class="bubble"></div>

    <!-- Ripple Effects -->
    <div class="ripple"></div>
    <div class="ripple"></div>
    <div class="ripple"></div>

    <!-- Floating Nature & Cosmetic Icons -->
    <div class="floating-icons"><i class="bi bi-droplet-fill"></i></div>
    <div class="floating-icons"><i class="bi bi-flower1"></i></div>
    <div class="floating-icons"><i class="bi bi-tree"></i></div>
    <div class="floating-icons"><i class="bi bi-sun"></i></div>
    <div class="floating-icons"><i class="bi bi-cloud"></i></div>
    <div class="floating-icons"><i class="bi bi-droplet"></i></div>
    <div class="floating-icons"><i class="bi bi-flower2"></i></div>
    <div class="floating-icons"><i class="bi bi-brightness-high"></i></div>
    <div class="floating-icons"><i class="bi bi-egg"></i></div>
    <div class="floating-icons"><i class="bi bi-flower3"></i></div>
    <div class="floating-icons"><i class="bi bi-water"></i></div>
    <div class="floating-icons"><i class="bi bi-tree-fill"></i></div>
    <div class="floating-icons">ğŸ’„</div>
    <div class="floating-icons">ğŸ’…</div>
    <div class="floating-icons">âœ¨</div>
    <div class="floating-icons">ğŸŒ¸</div>
    <div class="floating-icons">ğŸŒº</div>
    <div class="floating-icons">ğŸ¦‹</div>

    <!-- Geometric Shapes -->
    <div class="geo-shape circle" style="top: 15%; left: 5%; animation-delay: 0s;"></div>
    <div class="geo-shape triangle" style="top: 30%; left: 85%; animation-delay: -1s;"></div>
    <div class="geo-shape square" style="top: 50%; left: 10%; animation-delay: -2s;"></div>
    <div class="geo-shape diamond" style="top: 70%; left: 75%; animation-delay: -3s;"></div>
    <div class="geo-shape circle" style="top: 80%; left: 30%; animation-delay: -4s;"></div>
    <div class="geo-shape triangle" style="top: 25%; left: 60%; animation-delay: -5s;"></div>
    <div class="geo-shape square" style="top: 65%; left: 90%; animation-delay: -6s;"></div>
    <div class="geo-shape diamond" style="top: 45%; left: 40%; animation-delay: -7s;"></div>

    <!-- Sparkles -->
    <div class="sparkle" style="top: 20%; left: 25%; animation-delay: 0s;"></div>
    <div class="sparkle" style="top: 40%; left: 70%; animation-delay: -0.5s;"></div>
    <div class="sparkle" style="top: 60%; left: 15%; animation-delay: -1s;"></div>
    <div class="sparkle" style="top: 75%; left: 80%; animation-delay: -1.5s;"></div>
    <div class="sparkle" style="top: 35%; left: 50%; animation-delay: -2s;"></div>
    <div class="sparkle" style="top: 85%; left: 60%; animation-delay: -2.5s;"></div>
    <div class="sparkle" style="top: 10%; left: 90%; animation-delay: -3s;"></div>
    <div class="sparkle" style="top: 55%; left: 35%; animation-delay: -3.5s;"></div>
    <div class="sparkle" style="top: 90%; left: 20%; animation-delay: -4s;"></div>
    <div class="sparkle" style="top: 25%; left: 85%; animation-delay: -4.5s;"></div>

    <!-- Floating Particles -->
    <div class="particle" style="left: 10%; animation-delay: 0s;"></div>
    <div class="particle" style="left: 20%; animation-delay: -1s;"></div>
    <div class="particle" style="left: 30%; animation-delay: -2s;"></div>
    <div class="particle" style="left: 40%; animation-delay: -3s;"></div>
    <div class="particle" style="left: 50%; animation-delay: -4s;"></div>
    <div class="particle" style="left: 60%; animation-delay: -5s;"></div>
    <div class="particle" style="left: 70%; animation-delay: -6s;"></div>
    <div class="particle" style="left: 80%; animation-delay: -7s;"></div>
    <div class="particle" style="left: 90%; animation-delay: -8s;"></div>

    <!-- Wave Animation -->
    <div class="wave-container">
        <div class="wave"></div>
        <div class="wave"></div>
        <div class="wave"></div>
    </div>
</div>

<!-- Success Toast Notification -->
<div class="position-fixed top-0 end-0 p-3" style="z-index: 99999;">
    <div id="successToast" class="toast align-items-center border-0" role="alert" aria-live="assertive" aria-atomic="true" 
         style="background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%); color: white; box-shadow: 0 4px 12px rgba(34, 197, 94, 0.4);">
        <div class="d-flex">
            <div class="toast-body d-flex align-items-center">
                <i class="bi bi-check-circle-fill me-2" style="font-size: 1.5rem;"></i>
                <span id="toastMessage" style="font-weight: 500;">Cáº­p nháº­t thÃ´ng tin thÃ nh cÃ´ng!</span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    </div>
</div>

<!-- Theme Toggle Button -->
<button class="btn btn-primary btn-theme-toggle" id="themeToggle" title="Chuyá»ƒn Ä‘á»•i cháº¿ Ä‘á»™ sÃ¡ng/tá»‘i"
        style="position: fixed !important; bottom: 20px !important; right: 20px !important; z-index: 99999 !important; border-radius: 50% !important; width: 60px !important; height: 60px !important; padding: 0 !important; box-shadow: 0 6px 20px rgba(0,0,0,0.15) !important; margin: 0 !important; transform: none !important; transition: all 0.3s ease !important; display: flex !important; align-items: center !important; justify-content: center !important;">
    <i class="bi bi-sun-fill text-white" id="themeIcon" style="font-size: 1.5rem;"></i>
</button>

<!-- Dashboard Section -->
    <div class="main-container">
        <div class="row">
            <!-- Sidebar -->
           <div class="col-md-3 col-lg-3">
    @await Html.PartialAsync("_CustomerSidebar")
</div>
            <!-- Main Content -->
     
        <div class="col-md-9 col-lg-9">
            <div class="p-4">
                <div class="card">
                    <div class="card-header text-center">
                        <h6 class="card-title mb-0">
                            <i class="bi bi-key me-2"></i>Äá»•i máº­t kháº©u
                        </h6>
                    </div>
                    <div class="card-body p-3">
                        <form id="changePasswordForm">
                           <div class="mb-1">
                                <label for="currentPassword" class="form-label">Máº­t kháº©u hiá»‡n táº¡i *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="currentPassword" required>
                                </div>
                                <div class="invalid-feedback" id="currentPasswordError" style="display: none;">
                                    Máº­t kháº©u hiá»‡n táº¡i khÃ´ng Ä‘Ãºng
                                </div>
                            </div>
                           <div class="mb-1">
                                <label for="newPasswordChange" class="form-label">Máº­t kháº©u má»›i *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="newPasswordChange" required>
                                </div>
                                <div class="strength-meter mt-1">
                                    <div class="strength-bar" id="changeStrengthBar"></div>
                                </div>
                                <!-- THÃŠM DÃ’NG NÃ€Y -->
                                <small class="text-muted" id="changeStrengthText">Nháº­p máº­t kháº©u Ä‘á»ƒ kiá»ƒm tra Ä‘á»™ máº¡nh</small>
                            </div>
                            <div class="mb-1">
                                <label for="confirmNewPasswordChange" class="form-label">XÃ¡c nháº­n máº­t kháº©u má»›i *</label>
                                <div class="input-group">
                                    <input type="password" class="form-control" id="confirmNewPasswordChange" required>
                                   
                                </div>
                            </div>
                            <small class="text-muted d-block mb-1">
                                <i class="bi bi-info-circle me-1"></i>
                                Máº­t kháº©u nÃªn cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±, bao gá»“m chá»¯ hoa, sá»‘ vÃ  kÃ½ tá»± Ä‘áº·c biá»‡t
                            </small>
                            <div class="d-flex gap-2 mb-1">
                                <button type="submit" class="btn btn-primary">
                                    <i class="bi bi-shield-check me-1"></i>Äá»•i máº­t kháº©u
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
// Xá»­ lÃ½ kiá»ƒm tra máº­t kháº©u hiá»‡n táº¡i
document.addEventListener('DOMContentLoaded', function() {
    const currentPasswordInput = document.getElementById('currentPassword');
    const errorMessage = document.getElementById('currentPasswordError');
    let checkTimeout;

    if (currentPasswordInput) {
        currentPasswordInput.addEventListener('input', function() {
            const password = this.value.trim();
            
            clearTimeout(checkTimeout);
            errorMessage.style.display = 'none';
            this.classList.remove('is-valid', 'is-invalid');

            if (password.length === 0) return;

            checkTimeout = setTimeout(() => {
                verifyCurrentPassword(password);
            }, 800);
        });
    }

    function verifyCurrentPassword(password) {
        fetch('/KhachHang/ThongTin/VerifyCurrentPassword', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `currentPassword=${encodeURIComponent(password)}`
        })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                errorMessage.style.display = 'none';
                currentPasswordInput.classList.remove('is-invalid');
                currentPasswordInput.classList.add('is-valid');
            } else {
                errorMessage.style.display = 'block';
                currentPasswordInput.classList.remove('is-valid');
                currentPasswordInput.classList.add('is-invalid');
            }
        })
        .catch(() => {
            errorMessage.style.display = 'block';
            currentPasswordInput.classList.remove('is-valid');
            currentPasswordInput.classList.add('is-invalid');
        });
    }

    // Xá»­ lÃ½ submit form Ä‘á»•i máº­t kháº©u
    document.getElementById('changePasswordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const currentPassword = document.getElementById('currentPassword').value.trim();
        const newPassword = document.getElementById('newPasswordChange').value.trim();
        const confirmPassword = document.getElementById('confirmNewPasswordChange').value.trim();
        
        // Validate
        if (!currentPassword) {
            alert('Vui lÃ²ng nháº­p máº­t kháº©u hiá»‡n táº¡i!');
            return;
        }
        
        if (!newPassword) {
            alert('Vui lÃ²ng nháº­p máº­t kháº©u má»›i!');
            return;
        }
        
        if (newPassword.length < 8) {
            alert('Máº­t kháº©u má»›i pháº£i cÃ³ Ã­t nháº¥t 8 kÃ½ tá»±!');
            return;
        }
        
        if (newPassword !== confirmPassword) {
            alert('Máº­t kháº©u xÃ¡c nháº­n khÃ´ng khá»›p!');
            return;
        }
        
        if (!currentPasswordInput.classList.contains('is-valid')) {
            alert('Vui lÃ²ng nháº­p Ä‘Ãºng máº­t kháº©u hiá»‡n táº¡i!');
            return;
        }
        
        // Gá»­i request Ä‘á»•i máº­t kháº©u
        fetch('/KhachHang/ThongTin/ChangePassword', {
            method: 'POST',
            headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
            body: `currentPassword=${encodeURIComponent(currentPassword)}&newPassword=${encodeURIComponent(newPassword)}`
        })
        .then(res => res.json())
        .then(result => {
            if (result.success) {
                // Reset form sau khi Ä‘á»•i máº­t kháº©u thÃ nh cÃ´ng
                document.getElementById('changePasswordForm').reset();
                // Reset validation states
                currentPasswordInput.classList.remove('is-valid', 'is-invalid');
                errorMessage.style.display = 'none';
                // Reset password strength
                const strengthBar = document.getElementById('changeStrengthBar');
                const strengthText = document.getElementById('changeStrengthText');
                if (strengthBar) {
                    strengthBar.style.width = '0%';
                    strengthBar.className = 'strength-bar';
                }
                if (strengthText) {
                    strengthText.textContent = 'Nháº­p máº­t kháº©u Ä‘á»ƒ kiá»ƒm tra Ä‘á»™ máº¡nh';
                }
                // Hiá»ƒn thá»‹ toast thÃ´ng bÃ¡o thÃ nh cÃ´ng
                showSuccessToast('Äá»•i máº­t kháº©u thÃ nh cÃ´ng!');
            } else {
                alert(result.message);
            }
        })
        .catch(() => {
            alert('CÃ³ lá»—i xáº£y ra khi Ä‘á»•i máº­t kháº©u!');
        });
    });

    // Kiá»ƒm tra Ä‘á»™ máº¡nh máº­t kháº©u
    const newPasswordInput = document.getElementById('newPasswordChange');
    if (newPasswordInput) {
        newPasswordInput.addEventListener('input', function() {
            checkPasswordStrength(this.value, 'changeStrengthBar', 'changeStrengthText');
        });
    }

    function checkPasswordStrength(password, barId, textId) {
        const bar = document.getElementById(barId);
        const text = document.getElementById(textId);
        
        if (!bar || !text) return;
        
        if (password.length === 0) {
            bar.style.width = '0%';
            bar.className = 'strength-bar';
            text.textContent = 'Nháº­p máº­t kháº©u Ä‘á»ƒ kiá»ƒm tra Ä‘á»™ máº¡nh';
            return;
        }
        
        let score = 0;
        if (password.length >= 8) score++;
        if (/[a-z]/.test(password)) score++;
        if (/[A-Z]/.test(password)) score++;
        if (/[0-9]/.test(password)) score++;
        if (/[^A-Za-z0-9]/.test(password)) score++;
        
        if (score <= 2) {
            bar.style.width = '33%';
            bar.className = 'strength-bar strength-weak';
            text.textContent = 'Máº­t kháº©u yáº¿u';
        } else if (score <= 3) {
            bar.style.width = '66%';
            bar.className = 'strength-bar strength-medium';
            text.textContent = 'Máº­t kháº©u trung bÃ¬nh';
        } else {
            bar.style.width = '100%';
            bar.className = 'strength-bar strength-strong';
            text.textContent = 'Máº­t kháº©u máº¡nh';
        }
    }
});

// Submenu toggle function
function toggleSubMenu(menu) {
    const subMenus = {
        'info': 'infoSubMenu',
        'orders': 'ordersSubMenu'
    };
    
    Object.keys(subMenus).forEach(key => {
        const submenu = document.getElementById(subMenus[key]);
        if (key === menu) {
            if (submenu.classList.contains('submenu-hidden')) {
                submenu.classList.remove('submenu-hidden');
                submenu.classList.add('submenu-slide');
            } else {
                submenu.classList.remove('submenu-slide');
                submenu.classList.add('submenu-hidden');
            }
        } else {
            submenu.classList.remove('submenu-slide');
            submenu.classList.add('submenu-hidden');
        }
    });
}

// Function to show success toast
function showSuccessToast(message) {
    const toastElement = document.getElementById('successToast');
    const toastMessage = document.getElementById('toastMessage');
    
    if (toastMessage) {
        toastMessage.textContent = message;
    }
    
    if (toastElement) {
        const toast = new bootstrap.Toast(toastElement, {
            autohide: true,
            delay: 3000
        });
        toast.show();
    }
}

// Theme management
const themeToggle = document.getElementById("themeToggle");
const themeIcon = document.getElementById("themeIcon");

function updateTheme(theme) {
    document.documentElement.setAttribute("data-bs-theme", theme);
    themeIcon.className = theme === "dark" ? "bi bi-moon-fill text-white" : "bi bi-sun-fill text-white";
    localStorage.setItem("theme", theme);
}

themeToggle.addEventListener("click", () => {
    const currentTheme = document.documentElement.getAttribute("data-bs-theme");
    const newTheme = currentTheme === "dark" ? "light" : "dark";
    updateTheme(newTheme);
});

// Load saved theme
const savedTheme = localStorage.getItem("theme") || "light";
updateTheme(savedTheme);



// ThÃªm vÃ o cuá»‘i script (sau pháº§n Theme management)

// Function stubs for order filtering (to prevent errors)
function filterOrdersByStatus(status) {
    window.location.href = '/KhachHang/DonHang/Index';
}
</script>


